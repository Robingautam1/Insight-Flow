<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InsightFlow Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/htm@3.1.1/dist/htm.umd.js"></script>
    <script src="https://unpkg.com/recharts@2.12.0/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background-color: #e0f2fe;
            /* Debug Blue */
            font-family: sans-serif;
        }

        #loader {
            fixed;
            inset: 0;
            background: white;
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
        }
    </style>
</head>

<body>
    <div id="loader">
        <h1 class="text-2xl font-bold mb-4">Loading Dashboard...</h1>
        <div id="status" class="text-gray-500">Initializing Scripts...</div>
        <div id="error-disp" class="text-red-500 font-mono mt-4 text-sm whitespace-pre-wrap p-4 bg-red-50 hidden"></div>
    </div>
    <div id="root" class="h-screen w-full hidden"></div>

    <script>
        const status = document.getElementById('status');
        const errorDisp = document.getElementById('error-disp');
        const loader = document.getElementById('loader');
        const rootEl = document.getElementById('root');

        window.onerror = function (msg, url, line, col, error) {
            errorDisp.classList.remove('hidden');
            errorDisp.textContent = `Global Error: ${msg}\nLine: ${line}`;
            return false;
        };

        try {
            status.textContent = "Checking Dependencies...";
            if (!window.React) throw new Error("React missing");
            if (!window.ReactDOM) throw new Error("ReactDOM missing");
            if (!window.htm) throw new Error("htm missing");

            status.textContent = "Starting React...";
            const html = htm.bind(React.createElement);
            const { useState, useEffect } = React;
            const RC = window.Recharts || {};

            // --- Icons ---
            const Icon = ({ name, size = 20, className = "" }) => {
                if (!window.lucide || !window.lucide.icons[name]) return html`<span>?</span>`;
                const [tag, attrs, children] = window.lucide.icons[name];
                return React.createElement(tag, { ...attrs, width: size, height: size, className: `lucide lucide-${name} ${className}` },
                    children && children.map(([t, a], i) => React.createElement(t, { ...a, key: i }))
                );
            };

            // --- Components ---
            const Metric = ({ label, value, color }) => html`
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 p-6">
                    <div class="text-slate-500 text-sm font-medium mb-1">${label}</div>
                    <div class="text-3xl font-bold text-slate-800">${value}</div>
                    <div class="h-1 w-full bg-${color}-100 mt-4 rounded-full overflow-hidden">
                        <div class="h-full bg-${color}-500 w-2/3"></div>
                    </div>
                </div>
            `;

            const Dashboard = () => {
                return html`
                    <div class="p-8 max-w-7xl mx-auto space-y-8">
                        <div class="flex items-center justify-between">
                            <h1 class="text-3xl font-bold text-slate-800">InsightFlow</h1>
                            <div class="flex items-center gap-2">
                                <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-bold">Authenticated</span>
                                <div class="w-10 h-10 bg-gradient-to-tr from-blue-600 to-indigo-600 rounded-full text-white flex items-center justify-center font-bold">JD</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                            <${Metric} label="Total Revenue" value="â‚¹12.4L" color="blue" />
                            <${Metric} label="Active Users" value="1,240" color="green" />
                            <${Metric} label="New Orders" value="356" color="purple" />
                            <${Metric} label="Bounce Rate" value="42%" color="orange" />
                        </div>

                        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 h-96 flex flex-col">
                            <h3 class="text-lg font-bold text-slate-800 mb-6">Revenue Performance</h3>
                            ${RC.AreaChart ? html`
                                <div class="flex-1 w-full h-full">
                                    <${RC.ResponsiveContainer} width="100%" height="100%">
                                        <${RC.AreaChart} data=${Array.from({ length: 30 }, (_, i) => ({ name: i, val: Math.random() * 100 }))}>
                                            <${RC.CartesianGrid} strokeDasharray="3 3" vertical=${false} />
                                            <${RC.XAxis} dataKey="name" hide />
                                            <${RC.YAxis} />
                                            <${RC.Tooltip} />
                                            <${RC.Area} type="monotone" dataKey="val" stroke="#3b82f6" fill="#eff6ff" strokeWidth=${3} />
                                        </${RC.AreaChart}>
                                    </${RC.ResponsiveContainer}>
                                </div>
                            ` : html`<div class="text-red-500">Recharts failed to load</div>`}
                        </div>
                    </div>
                `;
            };

            // --- Mount ---
            status.textContent = "Mounting Root...";
            const root = ReactDOM.createRoot(rootEl);
            root.render(html`<${Dashboard} />`);

            // Success
            setTimeout(() => {
                loader.classList.add('hidden');
                rootEl.classList.remove('hidden');
            }, 600);

        } catch (e) {
            console.error(e);
            errorDisp.classList.remove('hidden');
            errorDisp.textContent = `Script Error: ${e.message}\n${e.stack}`;
        }
    </script>
</body>

</html>